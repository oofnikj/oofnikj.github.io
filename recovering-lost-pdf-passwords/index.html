<!doctype html>
<html lang="en-us">
  <head>
    <title>recovering lost pdf passwords | bad gateway</title>
    <link rel="shortcut icon" href="/bg.png" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.89.4" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="oofnik" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://badgateway.qc.to/css/main.min.02efab24bda74e45d28d671d441895c41b3f5869b39db2e9fdbd13c500c8ce06.css" />

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-186231180-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="recovering lost pdf passwords"/>
<meta name="twitter:description" content="How to recover a lost PDF password using open source tools."/>

    <meta property="og:title" content="recovering lost pdf passwords" />
<meta property="og:description" content="How to recover a lost PDF password using open source tools." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://badgateway.qc.to/recovering-lost-pdf-passwords/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-26T22:15:01+03:00" />
<meta property="article:modified_time" content="2021-04-26T22:15:01+03:00" />


    <script data-goatcounter="https://badgateway.goatcounter.com/count"
      async src="//gc.zgo.at/count.js">
    </script>
  </head>
  <body>
    <header class="app-header">
      <a href="https://badgateway.qc.to/"><img class="app-header-avatar" src="/bg.png" alt="oofnik" /></a>
      <h1>bad gateway</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/posts/">Posts</a>
            &#xB7
          
          <a class="app-header-menu-item" href="/tags">Tags</a>
      </nav>
      <p>a collection of notes about dev and ops things</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/oofnikj" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://gitlab.com/oofnik" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-gitlab">
  <title>gitlab</title>
  <path d="M22.65 14.39L12 22.13 1.35 14.39a.84.84 0 0 1-.3-.94l1.22-3.78 2.44-7.51A.42.42 0 0 1 4.82 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.49h8.1l2.44-7.51A.42.42 0 0 1 18.6 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.51L23 13.45a.84.84 0 0 1-.35.94z"></path>
</svg></a>
        
          <a target="_blank" href="https://linkedin.com/in/jordan-sokolic" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>linkedin</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg></a>
        
          <a target="_blank" href="/index.xml" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-rss">
  <title>rss</title>
  <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
</svg></a>
        
      </div>
      <hr style="border: 0px; border-top: 1px dashed #f6f6f6; width: 10%;">
      <div class="container tagcloud">
        
                <a href="/tags/apache" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  apache
                </a>
                <a href="/tags/athena" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  athena
                </a>
                <a href="/tags/aws" 
                class="tagcloud-item" style="font-size: 1.0584059348440358rem;">
                  aws
                </a>
                <a href="/tags/azure" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  azure
                </a>
                <a href="/tags/backup" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  backup
                </a>
                <a href="/tags/bash" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  bash
                </a>
                <a href="/tags/bfg" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  bfg
                </a>
                <a href="/tags/blog" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  blog
                </a>
                <a href="/tags/bruteforce" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  bruteforce
                </a>
                <a href="/tags/datadog" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  datadog
                </a>
                <a href="/tags/devops" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  devops
                </a>
                <a href="/tags/dkms" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  dkms
                </a>
                <a href="/tags/docker" 
                class="tagcloud-item" style="font-size: 1.2095637166915911rem;">
                  docker
                </a>
                <a href="/tags/docker-compose" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  docker-compose
                </a>
                <a href="/tags/dvr" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  dvr
                </a>
                <a href="/tags/encryption" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  encryption
                </a>
                <a href="/tags/engineering" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  engineering
                </a>
                <a href="/tags/gcp" 
                class="tagcloud-item" style="font-size: 1.0584059348440358rem;">
                  gcp
                </a>
                <a href="/tags/gcs" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  gcs
                </a>
                <a href="/tags/git" 
                class="tagcloud-item" style="font-size: 1.0584059348440358rem;">
                  git
                </a>
                <a href="/tags/gitlab" 
                class="tagcloud-item" style="font-size: 1.2095637166915911rem;">
                  gitlab
                </a>
                <a href="/tags/gitops" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  gitops
                </a>
                <a href="/tags/haproxy" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  haproxy
                </a>
                <a href="/tags/helm" 
                class="tagcloud-item" style="font-size: 1.2095637166915911rem;">
                  helm
                </a>
                <a href="/tags/hostapd" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  hostapd
                </a>
                <a href="/tags/hugo" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  hugo
                </a>
                <a href="/tags/iptables" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  iptables
                </a>
                <a href="/tags/jenkins" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  jenkins
                </a>
                <a href="/tags/john" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  john
                </a>
                <a href="/tags/k3s" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  k3s
                </a>
                <a href="/tags/kubernetes" 
                class="tagcloud-item" style="font-size: 1.3168118696880717rem;">
                  kubernetes
                </a>
                <a href="/tags/linux" 
                class="tagcloud-item" style="font-size: 1.2095637166915911rem;">
                  linux
                </a>
                <a href="/tags/meta" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  meta
                </a>
                <a href="/tags/multiarch" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  multiarch
                </a>
                <a href="/tags/nat" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  nat
                </a>
                <a href="/tags/netem" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  netem
                </a>
                <a href="/tags/networking" 
                class="tagcloud-item" style="font-size: 1.2095637166915911rem;">
                  networking
                </a>
                <a href="/tags/openwrt" 
                class="tagcloud-item" style="font-size: 1.2095637166915911rem;">
                  openwrt
                </a>
                <a href="/tags/postgres" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  postgres
                </a>
                <a href="/tags/power" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  power
                </a>
                <a href="/tags/raspberrypi" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  raspberrypi
                </a>
                <a href="/tags/rdp" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  rdp
                </a>
                <a href="/tags/revisr" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  revisr
                </a>
                <a href="/tags/serverless" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  serverless
                </a>
                <a href="/tags/sql" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  sql
                </a>
                <a href="/tags/ssl" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  ssl
                </a>
                <a href="/tags/tcp" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  tcp
                </a>
                <a href="/tags/tiller" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  tiller
                </a>
                <a href="/tags/traefik" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  traefik
                </a>
                <a href="/tags/ubuntu" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  ubuntu
                </a>
                <a href="/tags/uwsgi" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  uwsgi
                </a>
                <a href="/tags/vlan" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  vlan
                </a>
                <a href="/tags/vnc" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  vnc
                </a>
                <a href="/tags/wifi" 
                class="tagcloud-item" style="font-size: 1.0584059348440358rem;">
                  wifi
                </a>
                <a href="/tags/wireshark" 
                class="tagcloud-item" style="font-size: 0.8rem;">
                  wireshark
                </a>
                <a href="/tags/wordpress" 
                class="tagcloud-item" style="font-size: 1.2095637166915911rem;">
                  wordpress
                </a>
    </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">recovering lost pdf passwords</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Apr 26, 2021
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          4 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
              <a class="tag" href="https://badgateway.qc.to/tags/john/">john</a>
              <a class="tag" href="https://badgateway.qc.to/tags/bruteforce/">bruteforce</a>
              <a class="tag" href="https://badgateway.qc.to/tags/encryption/">encryption</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>Sometimes we misplace important pieces of information. We write passwords on sticky notes that get thrown out, delete old junk that turned out to not actually be junk, or assume something was committed to memory when it fact you discover those sectors got overwritten by what you ate for breakfast when you go looking for it.</p>
<p>It turns out that if you know even just a little bit about the nature of the information you&rsquo;re trying to recover, it becomes exponentially easier to to do so.</p>
<h2 id="brute-force">Brute Force</h2>
<p>There are all sorts of clever tricks and shortcuts to cracking a password that often depend on some weakness of the implementation (think of lock picking), but the most sure-fire (and dumbest) way to get your password back is to brute force your way in. While brute force might conjure up images of trying to kick down a locked door until the wood splinters, it&rsquo;s really more like bringing a keyring with several hundred million keys and trying every single one. It may take a long time, but you can cut the time needed down by orders of magnitude if you&rsquo;re smart about which keys you actually try.</p>
<p>We&rsquo;ll use two popular open-source tools, <code>crunch</code> and <code>john</code>, to accomplish our goal.</p>
<hr>
<h2 id="know-your-enemy">Know Your Enemy</h2>
<p>If you don&rsquo;t know anything about the password you&rsquo;re trying to recover, you&rsquo;re in for a potential eternity of guessing. That&rsquo;s why authentication mechanisms that let on something about the nature of a failed authentication attempt are such a bad idea &ndash; they give an attacker information that can be used to potentially reduce the time needed to crack by an enormous factor because now he knows what <em>not</em> to try. Even a variation in time between attempts can be construed as information about the length or complexity of the password in question.</p>
<p>But let&rsquo;s say you&rsquo;re not Mr. Robot. Let&rsquo;s say, instead, you&rsquo;re just trying to open your final pay stub from your previous employer who sent it to you as an encrypted attachment, and you really don&rsquo;t feel like e-mailing their HR department <em>queue nervious laugh</em>. You probably know enough about your lost password to cut the guessing time down from 86 years on the <a href="https://en.wikipedia.org/wiki/Summit_(supercomputer)">OLCF-4</a> to a couple of hours on your 4-core MacBook Pro. You probably know, for example, how long it is, which characters are in it, and maybe you&rsquo;re even pretty sure about the numbers at the end.</p>
<p>With that knowledge, we can use <code>crunch</code> to generate a word list of all plausible permutations of the password we&rsquo;re trying to guess.</p>
<p>In my case, I knew that I was looking for a password that was:</p>
<ol>
<li>six characters in length</li>
<li>composed exclusively of capital letters (A-Z) and numbers (0-9)</li>
</ol>
<h2 id="attack">Attack</h2>
<p>So we run <code>crunch</code> like this (consult the <code>man</code> page for how the options work):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ crunch <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">6</span> ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890 -o wordlist.txt
Crunch will now generate the following amount of data: <span style="color:#ae81ff">15237476352</span> bytes
<span style="color:#ae81ff">14531</span> MB
...
</code></pre></div><p><code>crunch</code> will deterministically iterate over all possible combinations of characters according to our parameters. After a few moments, we get 15 gigabytes of newline-delimited plaintext with our password presumably buried somewhere deep within.</p>
<p>The next tool we&rsquo;re using is called <a href="https://www.openwall.com/john/">John the Ripper</a>. <code>john</code>, for short, is a suite of &ldquo;security auditing&rdquo; tools that have been around for quite a while used to <del>crack</del> audit all kinds of passwords &ndash; encrypted Word documents, ZIP files, PDFs, *nix <code>/etc/passwd</code> hashes, you name it.</p>
<p>There&rsquo;s probably a native way to install <code>john</code> on your OS, but just to be sure we obtain the full suite, we&rsquo;ll download and compile it from source. I mean, we&rsquo;re hackers now, right?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ git clone https://github.com/openwall/john.git
$ pushd john/src <span style="color:#f92672">&amp;&amp;</span> ./configure <span style="color:#f92672">&amp;&amp;</span> make -j<span style="color:#66d9ef">$(</span>nproc<span style="color:#66d9ef">)</span>
$ popd
</code></pre></div><p>We&rsquo;re using a PDF as our example, so we&rsquo;ll use the <code>pdf2john</code> Perl script which comes with the suite to extract the password hash embedded in our document.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ john/run/pdf2john.pl document.pdf &gt; document.hash
</code></pre></div><p>And now, the fun part.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ john/run/john --wordlist<span style="color:#f92672">=</span>wordlist.txt --fork<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>nproc<span style="color:#66d9ef">)</span> document.hash
</code></pre></div><pre><code>Using default input encoding: UTF-8
Loaded 1 password hash (PDF [MD5 SHA2 RC4/AES 32/64])
Cost 1 (revision) is 3 for all loaded hashes
Node numbers 1-8 of 8 (fork)
Press 'q' or Ctrl-C to abort, almost any other key for status
...
Use the &quot;--show --format=PDF&quot; options to display all of the cracked passwords reliably
Session completed.
</code></pre>
<p>The <code>--fork=$(nproc)</code> bit will tell <code>john</code> to split the work up across all available CPU cores on your system.<code>john</code> will stop when it finds a match.</p>
<p>I was sitting on the other side of the room; I knew it was done when the fans stopped whirring at full blast.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ ./john/run/john --show --format<span style="color:#f92672">=</span>PDF document.hash
doc.pdf:ABC123
</code></pre></div><p>Bada-<em>boom</em>.</p>
<hr>
<h2 id="sources">Sources</h2>
<ol>
<li><a href="https://en.wikipedia.org/wiki/Summit_(supercomputer)">https://en.wikipedia.org/wiki/Summit_(supercomputer)</a></li>
<li><a href="https://tools.kali.org/password-attacks/crunch">https://tools.kali.org/password-attacks/crunch</a></li>
<li><a href="https://www.openwall.com/john/">https://www.openwall.com/john/</a></li>
</ol>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
